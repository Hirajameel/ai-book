"use strict";(globalThis.webpackChunkfrontend_docu=globalThis.webpackChunkfrontend_docu||[]).push([[8750],{8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},8797(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises/index","title":"Chapter 3: Hands-on Exercise","description":"Exercise: Communication Patterns in ROS 2","source":"@site/docs/module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises/index.md","sourceDirName":"module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises","slug":"/module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises/","permalink":"/ai-book/docs/module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-robotic-nervous-system/chapter-3-communication-patterns/exercises/index.md","tags":[],"version":"current","frontMatter":{}}');var t=s(4848),r=s(8453);const o={},l="Chapter 3: Hands-on Exercise",a={},c=[{value:"Exercise: Communication Patterns in ROS 2",id:"exercise-communication-patterns-in-ros-2",level:2},{value:"Objective",id:"objective",level:3},{value:"Part 1: Publisher/Subscriber with QoS Experimentation",id:"part-1-publishersubscriber-with-qos-experimentation",level:3},{value:"Part 2: Service Implementation",id:"part-2-service-implementation",level:3},{value:"Part 3: Action Implementation",id:"part-3-action-implementation",level:3},{value:"Part 4: Client Implementation",id:"part-4-client-implementation",level:3},{value:"Part 5: Build and Test",id:"part-5-build-and-test",level:3},{value:"Discussion Questions",id:"discussion-questions",level:3},{value:"Performance Analysis",id:"performance-analysis",level:3}];function _(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"chapter-3-hands-on-exercise",children:"Chapter 3: Hands-on Exercise"})}),"\n",(0,t.jsx)(n.h2,{id:"exercise-communication-patterns-in-ros-2",children:"Exercise: Communication Patterns in ROS 2"}),"\n",(0,t.jsx)(n.h3,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(n.p,{children:"Implement and experiment with different ROS 2 communication patterns (Topics, Services, Actions) to understand their use cases in humanoid robotics."}),"\n",(0,t.jsx)(n.h3,{id:"part-1-publishersubscriber-with-qos-experimentation",children:"Part 1: Publisher/Subscriber with QoS Experimentation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a new package for this exercise:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python qos_experiment_pkg\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create a publisher node ",(0,t.jsx)(n.code,{children:"qos_publisher.py"})," that publishes sensor data with different QoS profiles:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\n\nclass QoSPublisher(Node):\n    def __init__(self):\n        super().__init__('qos_publisher')\n\n        # Create publishers with different QoS profiles\n        # Reliable communication (for critical data)\n        reliable_qos = QoSProfile(\n            reliability=ReliabilityPolicy.RELIABLE,\n            history=HistoryPolicy.KEEP_LAST,\n            depth=10\n        )\n        self.reliable_publisher = self.create_publisher(\n            String, 'reliable_data', reliable_qos)\n\n        # Best effort communication (for high-frequency data)\n        best_effort_qos = QoSProfile(\n            reliability=ReliabilityPolicy.BEST_EFFORT,\n            history=HistoryPolicy.KEEP_LAST,\n            depth=5\n        )\n        self.best_effort_publisher = self.create_publisher(\n            String, 'best_effort_data', best_effort_qos)\n\n        # Start timers for both publishers\n        self.reliable_timer = self.create_timer(1.0, self.reliable_timer_callback)\n        self.best_effort_timer = self.create_timer(0.1, self.best_effort_timer_callback)\n\n        self.reliable_count = 0\n        self.best_effort_count = 0\n\n    def reliable_timer_callback(self):\n        msg = String()\n        msg.data = f'Reliable message #{self.reliable_count}'\n        self.reliable_publisher.publish(msg)\n        self.get_logger().info(f'Published: {msg.data}')\n        self.reliable_count += 1\n\n    def best_effort_timer_callback(self):\n        msg = String()\n        msg.data = f'Best effort message #{self.best_effort_count}'\n        self.best_effort_publisher.publish(msg)\n        self.best_effort_count += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    qos_publisher = QoSPublisher()\n    rclpy.spin(qos_publisher)\n    qos_publisher.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"part-2-service-implementation",children:"Part 2: Service Implementation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create a service definition file ",(0,t.jsx)(n.code,{children:"GetJointPosition.srv"})," in ",(0,t.jsx)(n.code,{children:"ros2_ws/src/qos_experiment_pkg/qos_experiment_pkg/"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Request\nstring joint_name\n---\n# Response\nfloat64 position\nbool success\nstring message\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create a service server ",(0,t.jsx)(n.code,{children:"joint_service_server.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom your_interfaces.srv import GetJointPosition  # You'll need to create this interface\n\nclass JointServiceServer(Node):\n    def __init__(self):\n        super().__init__('joint_service_server')\n        self.srv = self.create_service(\n            GetJointPosition,\n            'get_joint_position',\n            self.get_joint_position_callback)\n\n        # Simulate joint positions\n        self.joint_positions = {\n            'left_hip_joint': 0.1,\n            'left_knee_joint': -0.5,\n            'left_ankle_joint': 0.4,\n            'right_hip_joint': -0.1,\n            'right_knee_joint': 0.5,\n            'right_ankle_joint': -0.4\n        }\n\n    def get_joint_position_callback(self, request, response):\n        joint_name = request.joint_name\n        if joint_name in self.joint_positions:\n            response.position = self.joint_positions[joint_name]\n            response.success = True\n            response.message = f'Position for {joint_name}: {response.position}'\n            self.get_logger().info(f'Service called for {joint_name}')\n        else:\n            response.position = 0.0\n            response.success = False\n            response.message = f'Joint {joint_name} not found'\n            self.get_logger().warn(f'Invalid joint name: {joint_name}')\n\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    service_server = JointServiceServer()\n    rclpy.spin(service_server)\n    service_server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"part-3-action-implementation",children:"Part 3: Action Implementation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create an action definition file ",(0,t.jsx)(n.code,{children:"MoveJoint.action"})," in ",(0,t.jsx)(n.code,{children:"ros2_ws/src/qos_experiment_pkg/qos_experiment_pkg/"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Goal\nstring joint_name\nfloat64 target_position\nfloat64 max_velocity\n---\n# Result\nbool success\nstring message\nfloat64 final_position\n---\n# Feedback\nfloat64 current_position\nfloat64 remaining_distance\nstring status\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create an action server ",(0,t.jsx)(n.code,{children:"joint_action_server.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer, GoalResponse, CancelResponse\nfrom rclpy.node import Node\nfrom your_interfaces.action import MoveJoint  # You'll need to create this interface\nimport time\nimport threading\n\nclass JointActionServer(Node):\n    def __init__(self):\n        super().__init__('joint_action_server')\n        self._action_server = ActionServer(\n            self,\n            MoveJoint,\n            'move_joint',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback)\n\n    def goal_callback(self, goal_request):\n        self.get_logger().info('Received goal request')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = MoveJoint.Feedback()\n        result = MoveJoint.Result()\n\n        joint_name = goal_handle.request.joint_name\n        target_pos = goal_handle.request.target_position\n\n        # Simulate joint movement\n        current_pos = 0.0  # In real system, get current position\n        step_size = 0.01\n\n        while abs(current_pos - target_pos) > 0.01:\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                result.success = False\n                result.message = 'Goal canceled'\n                return result\n\n            # Move joint (simulated)\n            if current_pos < target_pos:\n                current_pos += step_size\n            else:\n                current_pos -= step_size\n\n            # Update feedback\n            feedback_msg.current_position = current_pos\n            feedback_msg.remaining_distance = abs(current_pos - target_pos)\n            feedback_msg.status = f'Moving to {target_pos:.2f}, current: {current_pos:.2f}'\n\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Feedback: {feedback_msg.status}')\n\n            time.sleep(0.1)  # Simulate movement time\n\n        goal_handle.succeed()\n        result.success = True\n        result.message = f'Joint {joint_name} moved to {target_pos:.2f}'\n        result.final_position = current_pos\n\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_server = JointActionServer()\n    rclpy.spin(action_server)\n    action_server.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"part-4-client-implementation",children:"Part 4: Client Implementation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a client node ",(0,t.jsx)(n.code,{children:"communication_client.py"})," that demonstrates all three patterns:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom your_interfaces.srv import GetJointPosition\nfrom your_interfaces.action import MoveJoint\nfrom rclpy.action import ActionClient\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\n\nclass CommunicationClient(Node):\n    def __init__(self):\n        super().__init__('communication_client')\n\n        # Subscriber for sensor data\n        self.subscription = self.create_subscription(\n            String,\n            'reliable_data',\n            self.sensor_callback,\n            QoSProfile(\n                reliability=ReliabilityPolicy.RELIABLE,\n                history=HistoryPolicy.KEEP_LAST,\n                depth=10\n            )\n        )\n\n        # Service client\n        self.cli = self.create_client(GetJointPosition, 'get_joint_position')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n\n        # Action client\n        self._action_client = ActionClient(self, MoveJoint, 'move_joint')\n\n        # Timer to trigger different communication patterns\n        self.timer = self.create_timer(5.0, self.run_communication_demo)\n        self.demo_step = 0\n\n    def sensor_callback(self, msg):\n        self.get_logger().info(f'Subscriber received: {msg.data}')\n\n    def run_communication_demo(self):\n        if self.demo_step == 0:\n            self.call_service()\n        elif self.demo_step == 1:\n            self.send_action_goal()\n        elif self.demo_step == 2:\n            self.publish_message()\n\n        self.demo_step = (self.demo_step + 1) % 3\n\n    def call_service(self):\n        request = GetJointPosition.Request()\n        request.joint_name = 'left_knee_joint'\n\n        future = self.cli.call_async(request)\n        future.add_done_callback(self.service_callback)\n\n    def service_callback(self, future):\n        try:\n            response = future.result()\n            self.get_logger().info(f'Service response: {response.message}')\n        except Exception as e:\n            self.get_logger().error(f'Service call failed: {e}')\n\n    def send_action_goal(self):\n        goal_msg = MoveJoint.Goal()\n        goal_msg.joint_name = 'left_knee_joint'\n        goal_msg.target_position = 0.5\n        goal_msg.max_velocity = 1.0\n\n        self._action_client.wait_for_server()\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected')\n            return\n\n        self.get_logger().info('Goal accepted')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        self.get_logger().info(f'Received feedback: {feedback_msg.feedback.status}')\n\n    def result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.message}')\n\n    def publish_message(self):\n        # This would typically be a publisher, but we're using existing subscriber\n        # to demonstrate the concept\n        self.get_logger().info('Demonstrating publish/subscribe pattern')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    client = CommunicationClient()\n    rclpy.spin(client)\n    client.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"part-5-build-and-test",children:"Part 5: Build and Test"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Update ",(0,t.jsx)(n.code,{children:"package.xml"})," to include message dependencies:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<depend>std_msgs</depend>\n<depend>action_msgs</depend>\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Build the package:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select qos_experiment_pkg\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Run the different components in separate terminals:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Terminal 1: ",(0,t.jsx)(n.code,{children:"ros2 run qos_experiment_pkg qos_publisher"})]}),"\n",(0,t.jsxs)(n.li,{children:["Terminal 2: ",(0,t.jsx)(n.code,{children:"ros2 run qos_experiment_pkg joint_service_server"})]}),"\n",(0,t.jsxs)(n.li,{children:["Terminal 3: ",(0,t.jsx)(n.code,{children:"ros2 run qos_experiment_pkg joint_action_server"})]}),"\n",(0,t.jsxs)(n.li,{children:["Terminal 4: ",(0,t.jsx)(n.code,{children:"ros2 run qos_experiment_pkg communication_client"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"discussion-questions",children:"Discussion Questions"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"When would you use each communication pattern in a humanoid robot?"}),"\n",(0,t.jsx)(n.li,{children:"How do QoS settings affect real-time performance?"}),"\n",(0,t.jsx)(n.li,{children:"What are the advantages and disadvantages of each pattern?"}),"\n",(0,t.jsx)(n.li,{children:"How would you handle communication failures in each pattern?"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"performance-analysis",children:"Performance Analysis"}),"\n",(0,t.jsx)(n.p,{children:"Monitor the performance of each communication pattern:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"ros2 topic hz"})," to check message frequency"]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"ros2 service list"})," to verify services are available"]}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"ros2 action list"})," to verify actions are available"]}),"\n",(0,t.jsx)(n.li,{children:"Observe the logs to understand timing differences"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(_,{...e})}):_(e)}}}]);